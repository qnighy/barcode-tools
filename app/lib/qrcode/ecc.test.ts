import { expect, test } from "vitest";
import { BitArray } from "./bit-array";
import { encodeErrorCorrection } from "./ecc";

test("1-M one-block example", () => {
  const bits = new BitArray([
    0, 0, 0, 1, 0, 0, 0, 0,
    0, 0, 1, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 1, 1, 0, 0,
    0, 1, 0, 1, 0, 1, 1, 0,
    0, 1, 1, 0, 0, 0, 0, 1,
    1, 0, 0, 0, 0, 0, 0, 0,
    1, 1, 1, 0, 1, 1, 0, 0,
    0, 0, 0, 1, 0, 0, 0, 1,
    1, 1, 1, 0, 1, 1, 0, 0,
    0, 0, 0, 1, 0, 0, 0, 1,
    1, 1, 1, 0, 1, 1, 0, 0,
    0, 0, 0, 1, 0, 0, 0, 1,
    1, 1, 1, 0, 1, 1, 0, 0,
    0, 0, 0, 1, 0, 0, 0, 1,
    1, 1, 1, 0, 1, 1, 0, 0,
    0, 0, 0, 1, 0, 0, 0, 1,
  ]);
  const actual = encodeErrorCorrection(
    bits,
    1,
    "M"
  );
  const expected = new BitArray([
    0, 0, 0, 1, 0, 0, 0, 0,
    0, 0, 1, 0, 0, 0, 0, 0,
    0, 0, 0, 0, 1, 1, 0, 0,
    0, 1, 0, 1, 0, 1, 1, 0,
    0, 1, 1, 0, 0, 0, 0, 1,
    1, 0, 0, 0, 0, 0, 0, 0,
    1, 1, 1, 0, 1, 1, 0, 0,
    0, 0, 0, 1, 0, 0, 0, 1,
    1, 1, 1, 0, 1, 1, 0, 0,
    0, 0, 0, 1, 0, 0, 0, 1,
    1, 1, 1, 0, 1, 1, 0, 0,
    0, 0, 0, 1, 0, 0, 0, 1,
    1, 1, 1, 0, 1, 1, 0, 0,
    0, 0, 0, 1, 0, 0, 0, 1,
    1, 1, 1, 0, 1, 1, 0, 0,
    0, 0, 0, 1, 0, 0, 0, 1,
    1, 0, 1, 0, 0, 1, 0, 1,
    0, 0, 1, 0, 0, 1, 0, 0,
    1, 1, 0, 1, 0, 1, 0, 0,
    1, 1, 0, 0, 0, 0, 0, 1,
    1, 1, 1, 0, 1, 1, 0, 1,
    0, 0, 1, 1, 0, 1, 1, 0,
    1, 1, 0, 0, 0, 1, 1, 1,
    1, 0, 0, 0, 0, 1, 1, 1,
    0, 0, 1, 0, 1, 1, 0, 0,
    0, 1, 0, 1, 0, 1, 0, 1,
  ]);
  expect([...actual]).toEqual([...expected]);
});
