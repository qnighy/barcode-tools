import { expect, test } from "vitest";
import { generateSVGPath } from "./svg";
import { Bit } from "./bit";

test("generateSVGPath", () => {
  const mat: Bit[][] = [
    // 30    50    70    90   110   130   150
    //    40    60    80   100   120   140
    [1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1], // 20
    [1, 0, 0, 0, 0, 0, 1, 0, 1, 1, 1, 0, 1], // 30
    [1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1], // 40
    [1, 0, 1, 1, 1, 0, 1, 0, 0, 1, 1, 1, 1], // 50
    [1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 0, 0], // 60
    [1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1], // 70
    [1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, 1, 1], // 80
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0], // 90
    [1, 1, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1], // 100
    [0, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1], // 110
    [1, 1, 1, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0], // 120
    [0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 1, 1, 0], // 130
    [1, 1, 1, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1], // 140
                                             // 150
  ];
  const path = generateSVGPath("M2", mat, { moduleSize: 10 });
  const expectedPath = [
    // Finder 7x7
    "M20,20 L90,20 L90,90 L20,90",
    // Top-left large structure
    // #.#.#
    // ###.#
    // .##.#
    // .####
    // ###..
    // #....
    "M100,20 L110,20 L110,30 L120,30 L120,20 L130,20 L130,50 L140,50 L140,20 L150,20 L150,60 L130,60 L130,70 L110,70 L110,80 L100,80 L100,60 L110,60 L110,40 L100,40",
    // Finder 5x5 (counterclockwise)
    "M30,30 L30,80 L80,80 L80,30",
    // Finder 3x3
    "M40,40 L70,40 L70,70 L40,70",
    // A structure on the left
    // ...#
    // ####
    // ##..
    "M140,70 L150,70 L150,90 L130,90 L130,100 L110,100 L110,80 L140,80",
    // A structure on the right, nearly at the bottom
    // ##.
    // .##
    // ###
    "M20,100 L40,100 L40,110 L50,110 L50,130 L20,130 L20,120 L30,120 L30,110 L20,110",
    // 1x1 square
    "M50,100 L60,100 L60,110 L50,110",
    // Large structure at the bottom-right
    // ...#....
    // .#.#.#..
    // #######.
    // #....##.
    // .....###
    "M100,100 L110,100 L110,120 L120,120 L120,110 L130,110 L130,120 L140,120 L140,140 L150,140 L150,150 L120,150 L120,130 L80,130 L80,140 L70,140 L70,120 L80,120 L80,110 L90,110 L90,120 L100,120",
    // 1x2 rect at the bottom-right
    "M140,100 L150,100 L150,120 L140,120",
    // 1x1 square
    "M60,110 L70,110 L70,120 L60,120",
    // 1x1
    "M50,130 L60,130 L60,140 L50,140",
    // 3x1 rect at the bottom-left
    "M20,140 L50,140 L50,150 L20,150",
    // 1x1
    "M60,140 L70,140 L70,150 L60,150",
    // 2x1 rect at the bottom
    "M90,140 L110,140 L110,150 L90,150",
  ].join(" ");
  expect(path).toEqual(expectedPath);
});
